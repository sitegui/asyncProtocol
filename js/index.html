<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<title>Browser client test</title>
<script src="DataBuffer.js"></script>
<script src="DataArray.js"></script>
<script src="Data.js"></script>
<script src="Exception.js"></script>
<script src="Token.js"></script>
<script src="inflateFormat.js"></script>
<script src="inflateData.js"></script>
<script src="Connection.js"></script>
<script>
var CC_SUM = Connection.registerClientCall(1, "ii", "i")
var CC_DIV = Connection.registerClientCall(2, "ii", "f")

var E_ZERO = Connection.registerException(17)

var SC_ORANGE = Connection.registerServerCall(27, "s", "s")

var log = function (qual) {
	return function (data) {
		console.log(qual, data)
	}
}

var log2 = function (qual) {
	return function (data) {
		console.log("Erro("+data+")", qual)
	}
}

var conn = new Connection("ws://192.168.1.150:8002")
conn.onopen = function () {
	var i
	console.log("Connected")
	
	for (i=0; i<10; i++)
		conn.sendCall(CC_SUM, new Data().addInt(i).addInt(i), log(i), log2(i))
}
conn.onclose = function () {
	console.log("Closed")
}
conn.oncall = function (type, data, answer) {
	if (type == SC_ORANGE)
		answer(data.toUpperCase())
}
</script>
</head>

<body>
</body>
</html>
